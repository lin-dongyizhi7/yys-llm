# yys-chat 训练界面使用指南

## 🚀 界面概览

yys-chat 提供了两种训练界面，满足不同用户的需求：

1. **简单训练界面** (`simple_train_ui.py`) - 基础功能，适合快速开始
2. **高级训练界面** (`advanced_train_ui.py`) - 完整功能，包含实时监控

## 📋 界面功能对比

| 功能 | 简单界面 | 高级界面 |
|------|----------|----------|
| 训练配置 | ✅ | ✅ |
| 参数调整 | ✅ | ✅ |
| 实时日志 | ❌ | ✅ |
| 系统监控 | ❌ | ✅ |
| 训练历史 | ✅ | ✅ |
| 进度跟踪 | ❌ | ✅ |
| 日志导出 | ❌ | ✅ |

## 🛠️ 快速开始

### 方法 1: 使用简单界面

```powershell
# 启动简单训练界面
.\scripts\start_training_ui.ps1
```

### 方法 2: 使用高级界面

```powershell
# 启动高级训练界面
.\scripts\start_advanced_ui.ps1
```

### 方法 3: 直接运行 Python

```powershell
# 简单界面
python .\src\train\simple_train_ui.py

# 高级界面
python .\src\train\advanced_train_ui.py
```

## 🌐 访问界面

启动成功后，在浏览器中打开：
```
http://localhost:7861
```

## 📋 界面布局说明

### 简单训练界面

```
┌─────────────────────────────────────────────────────────┐
│                    🚀 yys-chat 模型训练                  │
│              配置参数并启动 LoRA/QLoRA 微调训练            │
├─────────────────────────────────────────────────────────┤
│ 📋 训练配置                    │ 🚀 快速开始              │
│ ┌─────────────────────────┐   │ ┌─────────────────────┐ │
│ │ 基础模型: [下拉选择]     │   │ │ **推荐配置:**        │ │
│ │ 训练数据集: [下拉选择]   │   │ │ - 模型: Qwen2-1.5B  │ │
│ │ 角色名称: [文本输入]     │   │ │ - 数据集: train.jsonl│ │
│ └─────────────────────────┘   │ │ - 角色: Mentor      │ │
│                               │ │ - 轮数: 3           │ │
│ ⚙️ 训练参数                    │ │ - 量化: none        │ │
│ ┌─────────────────────────┐   │ └─────────────────────┘ │
│ │ 训练轮数: [滑块 1-10]   │   │                         │
│ │ 批次大小: [滑块 1-8]    │   │ 📚 训练历史            │
│ │ 学习率: [滑块 1e-5~1e-3]│   │ ┌─────────────────────┐ │
│ │ 量化方式: [单选]        │   │ │ [🔄 查看历史]        │ │
│ └─────────────────────────┘   │ │ [历史记录表格]        │ │
│                               │ └─────────────────────┘ │
│ 🚀 开始训练 [按钮]            │                         │
│ ┌─────────────────────────┐   │                         │
│ │ 状态: [显示区域]         │   │                         │
│ └─────────────────────────┘   │                         │
└─────────────────────────────────────────────────────────┘
```

### 高级训练界面

```
┌─────────────────────────────────────────────────────────┐
│                🚀 yys-chat 高级训练界面                  │
│              配置参数、启动训练并实时监控进度              │
├─────────────────────────────────────────────────────────┤
│ 📋 训练配置                    │ 📊 系统监控              │
│ ┌─────────────────────────┐   │ ┌─────────────────────┐ │
│ │ 基础模型: [下拉选择]     │   │ │ 系统资源: [JSON显示] │ │
│ │ 训练数据集: [下拉选择]   │   │ │ [🔄 刷新]           │ │
│ │ 角色名称: [文本输入]     │   │ └─────────────────────┘ │
│ │ 训练轮数: [滑块 1-10]   │   │                         │
│ └─────────────────────────┘   │ 🚀 快速开始              │
│                               │ ┌─────────────────────┐ │
│ ⚙️ 训练参数                    │ │ **推荐配置:**        │ │
│ ┌─────────────────────────┐   │ │ - 模型: Qwen2-1.5B  │ │
│ │ 批次大小: [滑块 1-8]    │   │ │ - 数据集: train.jsonl│ │
│ │ 学习率: [滑块 1e-5~1e-3]│   │ │ - 角色: Mentor      │ │
│ │ 量化方式: [单选]        │   │ │ - 轮数: 3           │ │
│ └─────────────────────────┘   │ │ - 量化: none        │ │
│                               │ └─────────────────────┘ │
│ 🚀 开始训练 [⏹️ 停止训练]     │                         │
│ ┌─────────────────────────┐   │ 📚 训练历史            │
│ │ 训练状态: [显示区域]     │   │ ┌─────────────────────┐ │
│ └─────────────────────────┘   │ │ [🔄 查看历史]        │ │
│                               │ │ [历史记录表格]        │ │
│ 📝 实时训练日志                │ └─────────────────────┘ │
│ ┌─────────────────────────┐   │                         │
│ │ 训练日志: [大文本区域]   │   │                         │
│ │ [🗑️ 清空日志] [💾 导出] │   │                         │
│ └─────────────────────────┘   │                         │
└─────────────────────────────────────────────────────────┘
```

## ⚙️ 参数配置说明

### 基础模型选择

- **Qwen/Qwen2-1.5B-Instruct**: 推荐，适合入门，资源需求较低
- **Qwen/Qwen2-7B-Instruct**: 中等规模，效果更好，需要更多资源
- **Qwen/Qwen2-14B-Instruct**: 大规模，效果最佳，需要大量资源
- **microsoft/DialoGPT-medium**: 轻量级，适合快速测试
- **sshleifer/tiny-gpt2**: 超轻量级，仅用于功能验证

### 训练参数建议

#### CPU 训练 (推荐新手)
```
量化方式: none
批次大小: 1-2
训练轮数: 3-5
学习率: 2e-4
```

#### GPU 训练 (有 CUDA 环境)
```
量化方式: 4bit (QLoRA)
批次大小: 2-4
训练轮数: 3-5
学习率: 2e-4
```

#### 快速测试
```
量化方式: none
批次大小: 1
训练轮数: 1
学习率: 2e-4
```

## 📊 系统监控说明

高级界面提供实时系统监控：

- **CPU 使用率**: 显示当前 CPU 负载
- **内存使用**: 显示内存使用情况和总量
- **磁盘使用**: 显示磁盘空间使用情况
- **GPU 内存**: 如果可用，显示 GPU 内存分配情况

## 📝 日志功能说明

### 实时日志
- 训练过程中的所有输出都会实时显示
- 包含时间戳，便于跟踪进度
- 自动滚动，始终显示最新信息

### 日志管理
- **清空日志**: 清除当前显示的日志
- **导出日志**: 准备日志文件下载（功能待完善）

## 🚨 常见问题解决

### 1. 界面无法启动
```powershell
# 检查 Python 环境
python --version

# 检查依赖
pip list | findstr gradio
pip list | findstr psutil

# 安装缺失依赖
pip install gradio psutil
```

### 2. 训练启动失败
- 检查数据集文件是否存在
- 确认输出目录有写入权限
- 查看错误信息，确认参数正确

### 3. 训练过程中断
- 检查系统资源是否充足
- 确认没有其他程序占用资源
- 查看日志中的错误信息

### 4. 界面响应缓慢
- 减少日志更新频率
- 关闭不必要的系统监控
- 检查网络连接（如果启用了 share 功能）

## 🔧 自定义配置

### 修改端口
在启动脚本中修改：
```python
interface.launch(server_port=7862)  # 改为其他端口
```

### 修改更新频率
```python
# 状态更新频率
status_output.change(update_status, every=5)  # 每5秒

# 系统信息更新频率
system_info.change(refresh_system, every=15)  # 每15秒
```

### 添加新的基础模型
在 `get_available_models()` 函数中添加：
```python
def get_available_models():
    return [
        "Qwen/Qwen2-1.5B-Instruct",
        "Qwen/Qwen2-7B-Instruct",
        "your/custom-model",  # 添加自定义模型
        # ...
    ]
```

## 📈 性能优化建议

1. **日志管理**
   - 定期清理旧日志文件
   - 限制日志显示行数
   - 使用日志轮转

2. **系统监控**
   - 适当调整监控间隔
   - 避免过于频繁的资源检查
   - 在训练高峰期减少监控

3. **界面响应**
   - 使用异步操作处理长时间任务
   - 实现进度条显示
   - 添加取消操作功能

## 🎯 最佳实践

1. **首次使用**
   - 从简单界面开始
   - 使用推荐配置
   - 小数据集测试

2. **生产训练**
   - 使用高级界面
   - 监控系统资源
   - 保存训练日志

3. **故障排除**
   - 查看实时日志
   - 检查系统资源
   - 验证参数配置

---

通过这些训练界面，你可以轻松配置和启动模型训练，实时监控进度，并管理训练历史！🚀
